## 第七章

# 可信启动

对于开发人员来说，中情局的保密性、完整性和可用性三要素始终是最重要的。关于 "完整性"，安全启动是帮助维护平台完整性要求的珍贵功能。它也被称为验证启动。启用安全启动后，组件将在执行下一个组件之前对其进行验证。如果验证失败，下一个组件将不会被执行。这看起来非常有用。但其他软件如何知道安全启动是否已启用且启用正确？其他软件如何知道是否安全启动被错误禁用？

如今，即使我们相信系统是安全的，我们仍希望让其他实体有机会确认这种安全属性。一旦系统有办法证明它拥有这些属性，我们就可以说它是可信的。

| **注释** | “信任” 的定义不同于 “安全”。根据可信计算小组（TCG）的定义，如果一个实体总是以预期的方式达到预期的目的，那么它就是可信的。可信的系统可能不是安全的系统。例如，如果我们知道一个系统被病毒感染，而病毒每天下午5点扫描C盘，并通过http协议将所有doc文件上传到特定的 URL，那么我们就可以说这个系统是可信的，而不是安全的。|
| :--- | :--- |

TCG定义了一种让其他软件检查系统是否已启动到可信环境的方法。该过程称为TCG可信启动。

## 静态的测量信任根（SRTM）

TCG规范定义了特殊硬件 —— 可信平台模块（TPM）。TPM有一组加密引擎、非易失性存储、易失性存储和一组平台配置寄存器（PCR）。TCG规范定义了一组信任根（RoT）：

    • 测量信任根（RTM）：RTM执行初始测量过程。RTM是主机端的一些代码。在实际实现中，我们有两种不同类型的RTM —— 静态RTM（SRTM）或动态 RTM（DRTM）。我们将在后面讨论它们。RTM可能包括许多组件。在这些组件中，核心RTM（CRTM）指的是在平台重置后运行最初代码的组件。
    • 报告信任根（RTR）：RTR通过TPM PCR报告测量信息，并提供基于TPM身份验证PCR真实性的能力。
    • 存储信任根（RTS）：RTS为密钥和数据提供受保护的存储区域。

### 可信平台模块

TPM包括除了测量信任根之外的所有受信任功能。本书重点介绍如何在固件中使用TPM。有关TPM硬件及其功能的详细介绍，请参阅TPM规范或参考文献中列出的书籍。

TPM的平台配置寄存器(PCR)保存最终测量值。测量值遵循此处给出的等式。此操作为PCR扩展：

PCR<sub>(new)</sub> = HASH(PCR<sub>(old)</sub> || HASH(Data))

PCR扩展是修改PCR值的唯一方法。如果平台多次扩展PCR，所有数据都会散列到PCR中。

当平台使用SRTM时，C-SRTM是固件启动块代码。启动块固件可以是UEFI/PI BIOS中的PEI固件卷。它也可以是coreboot BIOS中的ROM阶段。如果启用了英特尔Boot Guard功能，它也可以是英特尔Boot Guard ACM。见图7-1。根据TCG平台固件概述规范，RTM需要测量所有的其他组件。

<div align=center><img src=Figures/Chapter-7-Screenshot/Figure-7-1.jpg></img></div>
<div align=center>图 7-1 使用SRTM的固件测量</div>
