## 第十二章

# 安全模型

在上一章中，我们介绍了不同的安全架构和设计，以实现一系列安全目标。在设计和架构讨论结束时，我们可能会有几个问题。具体来说，我如何知道设计是否足够好？是否有任何现有的框架或方案可以帮助我验证安全设计是否有效？对于这些问题，安全模型可以提供帮助。安全模型是一种用于描述系统的方法，也是一套满足安全要求的安全策略。例如，对第三方PCI选项ROM —— 系统固件不能信任它。我们需要验证PCI选项ROM，并授予PCI选项ROM的执行权。我们发现Clark-Wilson完整性模型可以应用于这一安全策略。该模型为不同的安全属性定义了九条规则，例如完整性、访问控制、审计和责任、审计和责任。利用这个模型，我们可以设计出一个安全的解决方案，并采用这些规则来提供必要的安全属性。

今天，我们有许多计算机安全模型。每个安全模型都是基于特定的安全策略在特定环境中开发和使用的。在本章中，我们将介绍一些安全模型，并将它们应用于固件安全特性。

## 机密性

机密性是信息技术中的一个重要安全属性。例如，在多级安全（MLS）系统中，信息可以处于不同的级别：绝密、机密、秘密和非机密。我们如何确保信息保持在正确的级别，并且不会流向安全级别较低的地方？

### 贝尔-拉帕杜拉（Bell-LaPadula）

在1970年代，大卫·艾略特·贝尔（David Elliott Bell）和伦纳德·J·拉帕杜拉（Leonard J. LaPadula）正式化了美国国防部（DoD）的多级安全（MLS）政策，并开发了贝尔-拉帕杜拉（Bell-LaPadula）模型。

在贝尔-拉帕杜拉模型中，主体和客体与安全级别或敏感级别相关联，例如绝密、机密、秘密和非机密。主体的最高安全级别称为许可级别。客体的安全级别称为数据分类级别。主体可以查看客体（读取）或更改客体（写入）。贝尔-拉帕杜拉模型中定义的主要规则如下：

    1）简单安全属性：在许可级别中的主体不能读取更高分类级别的客体。这被称为“不可向上读取”（NRU）。见图12-1，左侧。
    2）*（星）安全属性：在许可级别中的主体不能写入更低分类级别的客体。这被称为“不可向下写入”（NWD）。见图12-1，右侧。
       强制安全属性是指对客体具有读写访问权限的主体只能在相同的安全级别上执行这两个功能。
    3）任意安全属性：主体可以基于访问控制矩阵访问客体。
    4）平静原则：主体不能改变客体的安全级别。这个规则出现在第一个贝尔-拉帕杜拉模型中，但后来被移除。在实际环境中，客体的安全级别控制因系统而异。
    
<div align=center><img src=Figures/Chapter-12-Screenshot/Figure-12-1.jpg></img></div>
<div align=center>图 12-1 贝尔-拉帕杜拉模型</div>

贝尔-拉帕杜拉模型可防止数据从高安全级别流向低安全级别，但它只关注机密性。该模型不考虑数据的完整性。例如，星形属性不允许向下写，但允许向上写，这意味着客体的完整性可能会被篡改。我们将在下一节讨论完整性模型中的这一部分。

这些特性可以更正式地表达出来。我们从初步的术语开始：

允许: 
<!-- github markdown does not support LaTex -->
<!-- $ subjects \space x \space access \space x \space objects \rightarrow boolean $ -->
subjects x access x objects &rightarrow; boolean

控制: 
<!-- $ labels \space x \space labels \space \rightarrow boolean $ -->
labels x labels &rightarrow; boolean

其中无向上读取和无向下写入如下：

NRU: &forall;s &in; subjects, o &in; objects
<!-- $ NRU：\forall s \in subjects, o \in objects $ -->

当且仅当符号（s）控制符号（o）允许（s,o,read）

和

NWD: &forall;s &in; subjects, o &in; objects
<!-- $ NWD: \forall s \in subjects, o \in objects $ -->

当且仅当符号（s）控制符号（o）允许（s,o,write）

其中

labels = levels x P(categories)

示例可以包括

    levels = {confidential, secret}
    categories = {user, owner}
    P(categories) = {NULL, {user}, {owner}, {users, owner}}

和

    labels =
    {(confidential, {user}), (secret, {user}), (confidential, {owner}),
    (secret, {owner}), (confidential, (user, owner)},
    (secret, {users, owner}), (confidential, NULL), (secret, NULL)}

## 完整性

完整性是固件最重要的安全属性。NIST SP800-193提供了固件弹性准则，以维护固件的完整性。NIST SP800-155提供了完整性测量和认证指南。现在让我们来看看如何将完整性模型应用于它们。

### 毕巴（Biba）模型

1975年，Kenneth J.Biba提出了毕巴完整性模型，描述了一套确保数据完整性的访问控制策略和规则。

在毕巴模型中，主体和客体都与完整性级别相关联。对于主体来说，它由允许的完整性级别范围决定，以保持访问对象所需的最低完整性级别。对于对象来说，它意味着数据的重要性，例如关键、非常重要和重要。主体可以观察对象（读取）或修改对象（写入）。毕巴模型定义的主要规则如下：

    1）简单的完整性属性：完整性级别中的主体不能读取较低完整性级别的对象。这就是所谓的“不可向下读取”。见图12-2左侧。
    2）*（星）完整性属性：完整性级别的主体不能写入较高完整性级别的对象。这就是所谓的 “不可向上写入”。见图12-2右侧。
    3）调用属性：主体不能调用更高完整性级别中的主体。

<div align=center><img src=Figures/Chapter-12-Screenshot/Figure-12-2.jpg></img></div>
<div align=center>图 12-2 毕巴模型</div>

毕巴模型可防止数据从高完整性级别流向低完整性级别，但它只关注完整性。它不考虑机密性。在某些层面上，毕巴模型与贝尔-拉帕杜拉模型相反。对于简单安全属性，贝尔-拉帕杜拉模型不需要向上读取，而毕巴模型不需要向下读取。在星形安全属性中，贝尔-拉帕杜拉模型不需要向下写入，而毕巴模型不需要向上读取。

安全模型提供了一个框架指导你如何思考安全属性。特定的安全模型可能有其局限性。它可能是不必要的，因为某些规则可能过于严格或与其他规则相冲突。它可能不够充分，因为它没有涵盖某些实际用例。例如，如果一个现代商业系统同时需要机密性和完整性以及策略控制，那么它就需要同时应用毕巴模型和贝尔-拉帕杜拉模型。假设安全级别与完整性级别一致，那么规则就变成了只读等价和只写等价。隔离可能是实现这一目标的最佳方法。

### 克拉克-威尔逊（Clark-Wilson）模型

1987年，戴维-D-克拉克和戴维-R-威尔逊制定了克拉克-威尔逊商业策略，与前面列出的军事安全政策形成对比。它主要针对数据完整性问题的商业安全策略。克拉克-威尔逊模型包括以下概念：

    1）数据项
        A）受约束的数据项（CDI）
        B）不受约束的数据项（UDI）
    2）过程
        A）完整性验证过程（IVP）
        B）变换过程（TPs）
    3）规则：
        A）认证规则（CR）：完整性监控
           C1 —— （基础：IVP认证）：所有IVP必须正确确保所有CDI都处于有效状态。
           C2 —— （基础：有效性）：所有TP必须经过认证才有效。对于每个TP及其可能操纵的每组CDI，安全管理人员必须指定一种形式的“关系”（TP，{CDI}）。
           C3 —— （职责分离证明）：E2中的关系人名单必须经过认证，以满足分离职责要求。
           C4 —— （日志认证）：所有TP都必须通过认证，才能写入仅有附录的CDI（日志），所有信息需要自然操作许可才能重建。
           C5 —— （变换认证）：任何将UDI作为输入值的TP都必须经过认证，以便对UDI的任何可能值只执行有效的变换或不执行变换。转换应将输入值从UDI变换为CDI，否则UDI将被拒绝。
        B）执行规则（ER）：完整性保持
           E1 —— （基本：执行有效性）：系统必须维护C2中指定的关系列表，并确保只有经认证可在CDI上运行的TP才能操作该CDI。
           E2 —— （职责分离的执行）：系统必须将一个用户与每个TP和一组CDI关联起来，关系列表的形式为（user、TP、{CDI}）。系统必须确保只执行其中一种关系中描述的执行。
           E3 —— （用户身份）：系统必须认证每个试图执行TP的用户的身份。
           E4 —— （启动）：只有经认证实体许可的代理才能更改与其他实体相关的实体列表，特别是与TP相关的实体列表。可对实体进行认证的代理可能没有任何与该实体相关的执行权。

图12-3显示了克拉克-威尔逊模型中的认证规则和执行规则。

<div align=center><img src=Figures/Chapter-12-Screenshot/Figure-12-3.jpg></img></div>
<div align=center>图 12-3 克拉克-威尔逊模型</div>

该模型基于认证主体、程序和数据项之间的关系。这种关系的元素被称为“Clark-Wilson Triple”（User、TP、{CDI}）。克拉克-威尔逊模型在表12-1中显示了满足完整性安全属性所需的规则。

表 12-1 克拉克-威尔逊模型
| 属性 | 描述 | 规则 |
| :--- | :--- | :--- |
| 完整性 | 保证只能以受限方式修改CDI来产生有效的CDI。| C1,C2,C5,E1,E4 |
| 访问控制 | 控制访问资源的能力。| C3,E2,E3 |
| 审计 | 能够确定对CDI所做的更改，并确保系统处于有效状态。| C1,C4 |
| 计量性 | 能够将用户与他们的操作唯一地联系起来。| E3 |

由于克拉克-威尔逊模式聚焦于职责和事务，因此更适用于商业和工业流程。目前，一些论文描述了如何将克拉克-威尔逊完整性模型应用于现有系统，例如Windows、Java或可信计算小组（TCG）安全系统。

克拉克-威尔逊规则的数据示意图如下：

<!-- $ D = CDI \cup UDI $ -->
D = CDI &cup; UDI
<!-- $ CDI \cap UDI = \emptyset $ -->
CDI &cap; UDI = &emptyset;

并且变换流程(TP):

<!-- $ TP: subjects \space x \space D \rightarrow D $ -->
TP: subjects x D &rightarrow; D

### 其他

除了Bell-LaPadula、Biba和Clark-Wilson模型外，还有一些其他的安全模型，例如Brewer-Nash模型（也称为中国城墙模型）、Graham-Denning模型、Harrison-Ruzzo-Ullman模型、Take-Grant模型、Noninterference模型、安全信息流的Lattice模型等。我们不会在本章中介绍所有这些模型，而是将它们列在参考部分。

## 应用

让我们看看如何将安全模型应用于固件安全功能。

### 可信计算组安全模型

可信计算组（TCG）定义了解决系统完整性问题的安全模型。TCG定义的可信平台模块(TPM)是硬件中的信任根，为安全提供了基础。文章“可信计算组安全模型与克拉克-威尔逊安全模型的比较"提供了如表12-2所示的比较分析。

表 12-2 克拉克-威尔逊与TCG安全比较
| 规则 | 克拉克-威尔逊 | TCG安全 |
| :--- | :--- | :--- |
| C1 | 系统将有一个 IVP，用于验证任何 CDI 的完整性。| TPM实现了密钥、授权数据、会话、嵌入式密钥、平台配置寄存器（PCR）和标志的受保护功能。测量的核心信任根（CRTM）和其他流程对数据项进行测量。完整性可通过PCR（受保护能力）和外部IVP功能进行验证。测量将数据转换为部分受控数据项（PDI）。数据存在于受保护的位置之外，而数据的散列则存在于受保护的位置之内。|
| C2 | 对任何CDI应用TP都必须保持该CDI的完整性。| 在将对象传输到TPM物理边界之外之前，所有由TPM管理的CDI都要进行加密或签名。部分受控数据项（PDI）的哈希值保存在TPM中。损坏可检测，但需要外部TP才能从CDI的损坏中恢复。|
| C3 | CDI只能由经认证的TP更改。职责分离/最小特权。| 可根据ISO-15408指南对TPM进行评估。应用级CDI根据外部TP进行认证。TG 区分密钥加载（进入TPM）和密钥使用（签名/加密）。数据可“封装”到运行状态，建立运行最低权限。|
| C4 | 记录TP操作。| TPM 审计 TPM 命令调用，并使用数字签名保护审计记录的完整性。|
| C5 | 对UDI的操作会产生有效的CDI。| 传递信任使用TP测量包含测量代码的UDI。代码测量其他的UDI。这一归纳过程可将所有UDI转换为PDI。应用级TP将PDI转换为CDI。TPM迁移密钥通过TPM存储保护功能转换为CDI。应用于UDI的数字签名产生签名的UDI，它可被视为用于签名转换的CDI。TPM会话协议使用nonce来防止TPM和调用者之间的中间人操纵。|
| E1 | 只有经过认证的TP才能对CDI采取行动。| 针对特定TPM的数据可以封存到TPM密钥和平台配置中，这样只有TPM实现的受保护能力（TP）的特定实例才能用来解除封存。TPM管理的密钥可以封存到特定的TPM，确保只有该TPM实例才能恢复密钥。|
| E2 | 主体可以访问那些只通过TP授权的CDI。| 主体拥有的对象（密钥、秘密、密码等）都有相关的共享秘密授权数据，这些数据由TPM管理。知道该秘密就意味着获得了访问密钥的授权。密钥缓存管理器主体可能拥有授权数据，可以将密钥加载/卸载到TPM中。|
| E3 | 主体尝试执行TP前必须先通过认证。| TPM管理的CDI由TPM认证。TPM管理的PDI由外部TP认证。TPM所有者和管理操作需要的会话认证。|
| E4 | 只有管理员才能指定TP授权。| TCG定义了控制特权命令的所有者，包括更改所有者的能力。物理访问意味着所有者权限是固有的。|

### 固件弹性（保护，检测，恢复）

根据NIST SP800-193，系统需要保持固件的完整性和可用性。固件弹性包括保护、检测和恢复能力。固件保护是指锁定固件，只允许经过认证的固件更新。固件检测（又称安全启动或验证启动）是指在执行前使用一组策略对象来验证下一个固件组件。固件恢复是指在验证失败时启动恢复固件镜像。例如，为匹配C5，系统使用TP（验证程序）验证UDI（恢复固件镜像），将UDI转换为CDI（受信任的固件组件），并执行适当的操作，如更新、执行或恢复。

相比之下，TCG可信启动（也称为测量启动）过程不会验证下一个实体。它只会将下一个启动实体的摘要记录到可信位置，例如可信平台模块（TPM）中的平台配置寄存器（PCR）。这样就可以在启动过程的稍后阶段验证受信任的启动链。许多安全模型将安全启动和可信启动功能结合起来使用，以达到最佳效果。例如，如果系统启用了安全启动和可信启动，安全启动策略就会被测量到PCR7中。每当安全启动验证处理程序验证后续组件时，策略授权也会被计入PCR7。后续，验证程序可以知道所有安全启动策略，并知道哪个策略用于验证固件组件。表12-3列出了固件弹性中的克拉克-威尔逊与TCG安全比较模型。

表 12-3 固件弹性中的克拉克-威尔逊模型
| 属性 | 描述 | 规则 | 固件弹性 |
| :--- | :--- | :--- | :--- |
| 完整性 | 确保只能以受限方式修改CDI，以生成有效的CDI。| C1,C2,C5,E1,E4 | 固件需要验证下一个加载的组件、新固件组件、恢复组件、策略数据等。|
| 访问控制 | 控制访问资源的能力。| C3,E2,E3 | 固件弹性中没有用户概念。信任根或信任链可以访问资源。|
| 审计 | 能够确定对CDI所做的更改，并确保系统处于有效状态。| C1,C4 | TCG可信启动可以在TCG事件日志中记录验证信息，例如权限。|
| 计量性 | 能够将用户与他们的操作唯一地联系起来。| E3 | 固件弹性没有用户概念。信任根或信任链可以执行该操作。|

#### 固件弹性中的模式

定义：

    1)  固件[N]：N级别的固件二进制文件。任何固件级别都可更新。
        固件[0]是指由硬件验证的组件。
        固件[N]是指由固件[N-1]验证的组件。它可以包含代码（固件[N].代码）和数据（固件[N].数据）。
    2)  固件[N].代码：N级别的固件二进制文件的代码。它可以包含验证者（固件[N].代码.验证者）。
    3)  固件[N].数据：N级别的固件二进制文件的数据。它可以包含验证策略（固件[N].数据.策略）。
    4)  固件[N].代码.验证者：N级别的固件二进制文件的验证功能。
    5)  固件[N].数据.策略：N级别的固件二进制文件的策略数据。
        这数据由验证功能使用。验证功能和策略数据都有以下子类别：
        A) 启动：固件启动。
        B) 策略更新：策略更新，可有可无。
        C) 固件更新：固件更新（可以包括或不包括策略数据）。
        D) 恢复：固件恢复。
        E) 通信：固件运行时通信。
    6)  硬件：硬件，包括寄存器传输级（RTL）和寄存器。硬件不可更新。硬件在交付给最终用户时必须熔断。


