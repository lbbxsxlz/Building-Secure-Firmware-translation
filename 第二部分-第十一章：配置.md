## 第十一章

# 配置

用户可配置数据在相同固件代码下可用于控制固件行为。配置数据被设计成可由终端用户更新和更改，而固件代码通常只能由平台制造商编辑。因此，对配置数据的保护不同于对固件代码的保护。

UEFI变量是存储UEFI固件配置的一种方式。让我们以UEFI变量为例，介绍不同的保护机制。这些机制可用于实现固件配置数据的替代实现选择。

## UEFI变量

根据UEFI规范，UEFI变量用于存储UEFI组件之间传递的数据，例如平台制造商的组件、UEFI应用程序或UEFI操作系统加载程序。经典的CIA（保密性、完整性、可用性）安全属性应被视为UEFI变量的属性。攻击UEFI变量的对手可分为软件攻击者和硬件攻击者。软件攻击可通过执行调用UEFI SetVariable/GetVariable API和使用代码直接读/写变量存储或缓存区域来实现；硬件攻击可通过在变量更新期间关闭系统电源或使用闪存编程器读/写变量存储的闪存区域来实现。有关UEFI变量保护机制，见表11-1。我们将逐一介绍。

表 11-1 UEFI变量保护机制
| 机制 | 软件攻击抵抗 | 硬件攻击抵抗 |
| :--- | :--- | :--- |
| 完整性保护 | 变量认证 可信执行环境 变量锁 变量合理性检查 | 带有RPMB的变量 带有RPMC的变量 TPM存储的变量 |
| 可用性保护 | 变量配额管理 闪存磨损保护 | 变量原子性 容错写入（FTW）|
| 机密性保护 | 用户密钥加密的变量 | 平台密钥加密的变量 用户密钥加密的变量 |

### 完整性保护

#### 变量认证

