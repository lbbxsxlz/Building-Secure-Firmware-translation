# 维护

产品发货后，我们将进入产品维护阶段。此后可能收到来自外部或内部客户的安全问题报告。一旦确认问题，我们需要修复该问题并准备固件更新，以便部署到所有现有的在用产品中。修复安全问题的时间至关重要，因为从问题发现到修复完成期间，产品始终面临遭受攻击的风险。

## 缓解策略与对策

微软描述了软件漏洞缓解策略 —— 使漏洞的发现、利用和滥用变得困难且代价高昂 —— 并提出了四项对策（消除漏洞、破坏利用途径、控制损害范围、缩短漏洞利用时间窗口）。这些策略和对策同样适用于固件漏洞缓解。表23-1展示了固件漏洞缓解对策。

表 23-1 固件漏洞缓解对策

|  对策  | 架构与设计 |  实现  |  维护  |
| ------ | ------ | ------ | ------ |
| 消除漏洞 | 减少攻击面，例如不必要的SMI处理程序。<br>采用安全设计原则，例如最小权限原则。<br>使用正确的加密算法。| 启用编译器防御性技术，例如代码消毒器、静态分析和动态分析。<br>使用类型安全的语言，例如Rust。<br>使用漏洞扫描工具。| 增强漏洞扫描工具。|
| 破坏利用 | 采用固件弹性机制 —— 保护、检测和恢复功能 —— 例如安全启动。<br>采用固件完整性测量与证明机制，例如测量启动。| 启用编译器防御技术，例如栈、cookie、地址空间布局随机化（ASLR）、数据执行保护（DEP）、代码完整性防护（CIG）、任意代码防护（ACG）、控制流防护（CFG）等。<br>启用内核保护技术，如监督模式执行预防（SMEP）、监督模式访问预防（SMAP）、内核页表隔离（KPTI）等。| |
| 控制损害 | 采用容器与虚拟化技术（纵向）。<br>采用隔离与分区技术（横向）。| 启用监督模式。<br>启用虚拟机监控程序。<br>启用可信执行环境（TEE）。| |
| 减少攻击窗口 | 采用固件弹性机制 —— 更新。<br>定义固件更新流程。| 启用固件组件级更新。| 启用固件供应链检测。<br>启用有效的固件漏洞检测。<br>UEFI扫描器。|

表 23-2 UEFI/EDK II系统固件中的示例

|  对策  | 方法 | UEFI/EDK II示例 |
| ------ | ------ | ------ |
| 消除漏洞 | 减少攻击面<br>静态分析/动态分析<br>安全测试/模糊测试<br>/漏洞扫面 | SMI处理程序配置文件<br>Clang静态分析，内存消毒器，KLEE<br>基于主机的固件分析器，Peach，AFL<br>CHIPSEC |
| 破坏利用 | 栈防护<br>地址空间布局随机化<br>数据执行预防<br>任意代码防护<br>控制流防护<br>代码完整性防护 | MSVC:/GS, GCC:-fstack-protector<br>DXE/SMM ASLR<br>SMM内存保护<br>UEFI核心内存保护<br>DXE/SMM控制流强制技术（CET）<br>UEFI安全启动 |
| 控制损害 | 沙箱<br>降权<br>隔离 | EBC<br>基于Ring3的OPROM，SMI处理程序<br>基于Ring3的OPROM，SMI处理程序 |
| 减少攻击窗口 | 弹性<br>测量与证明<br>防病毒 | 签名更新，安全启动，签名恢复，闪存锁定<br>测量启动（SRTM），安全启动（DRTM）<br>UEFI扫描器 |

