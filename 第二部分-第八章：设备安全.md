## 第八章

# 设备安全

硬件设备是解决方案的重要组成部分。它和板上的其他设备是平台的一部分，例如可信平台模块（TPM）设备、底板管理控制器（BMC）、电源提供单元（PSU）等等。也可以是独立的设备，例如通用串行总线（USB）设备、图形卡设备、网卡设备、硬盘设备等等。

## 设备固件弹性

《高度安全设备的七大特性》介绍了如下的设计原则：

    1. 基于硬件的信任根
    2. 小型可信计算基础
    3. 纵深防御
    4. 区隔化
    5. 基于证书的认证
    6. 可再生安全
    7. 故障报告

原则3，4与通用安全软件设计原则类似。原则1，2，5，6，7与硬件/固件弹性有关。设备固件弹性应该遵循和主机固件弹性相同的规则。保护、检测和恢复都应该考虑。第3，4，5章已经对此进行了讨论。

## 安全设备通信

在系统启动过程中，主机需要与设备通信以交换信息。这种通信通道可能会受到硬件对手的攻击。攻击机制可能包括但不限于拦截、修改、窃听和伪装。

### 认证与测量

与主机固件类似，平台可能希望定义一种为设备执行证明的方法，而不仅仅是支持设备固件的弹性。这包括设备硬件身份认证和设备固件身份测量。

图8-1举例说明了如何使用非对称加密技术来实现这一目标。每台设备都配有一个证书。证书的公共部分通过平台活动信任根（PA-RoT）被知晓。证书的私有部分作为秘密保存在设备不可改变的ROM中，作为活动组件信任根（AC-RoT）。在系统启动过程中，平台信任根作为发起者发送消息给设备信任根（回应者），设备发送回应。

<div align=center><img src=Figures/Chapter-8-Screenshot/Figure-8-1.jpg></img></div>
<div align=center>图 8-1 设备认证与测量流程</div>

在识别阶段，平台信任根请求设备证书，设备信任根返回设备的公共证书。然后，平台信任根可以知道哪个设备在平台上。

接下来，在认证阶段，平台信任根会向设备信任根发送一个质疑消息，设备信任根用其私人证书加密质疑值作为回应。有了质疑/响应，平台信任根就可以知道设备是真实的。

最后，在测量阶段，平台信任根请求设备的测量值，包括不可改变ROM、可变固件、硬件配置和固件配置的测量值。一旦设备信任根返回这些信息，平台信任根可将这些信息保存到TPM设备（用于存储和报告的信任根）中，以便进一步进行平台证明。

### 安全通信通道

一旦平台信任根认证设备后，可能需要交换信息。平台信任根信任设备，但平台信任根可能不信任它们之间的链接。攻击者可能会劫持硬件总线来攻击平台信任根和设备之间的链接。平台主板上的连接类似于今天的互联网 —— 两个端点需要在不受信任的世界中创建一个安全通道。互联网中最著名的安全通道是传输层安全（TLS）。TLS可以在握手阶段提供身份认证，在应用阶段提供保密性和完整性。最初的TLS是在面向连接的协议（例如传输控制协议）之上的一个协议。TLS概念也可用于其他协议，例如可扩展身份认证协议（EAP）。TLS的变种 —— 数据报TLS（DTLS）—— 可用于无连接协议，例如用户数据报协议（UDP）。

安全通道可以包括三个阶段：握手、应用和终止（见图8-2）。在握手阶段，发起者和响应者需要交换密钥和加密参数，并进行身份认证。在握手阶段结束时，发起者和响应者都能计算出一组会话密钥，用于加密消息和计算信息的信息认证码（MAC）。在应用阶段，发起方和响应方可交换应用层信息，这些信息由会话密钥加密，并由会话MAC密钥MAC化。通信结束后，会话即被关闭。

<div align=center><img src=Figures/Chapter-8-Screenshot/Figure-8-2.jpg></img></div>
<div align=center>图 8-2 设备安全通信</div>

